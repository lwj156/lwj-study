# 问题记录

## springboot安全问题

> 记录一次springboot使用actuator作为监控的安全问题：

<img src="https://gitee.com/lwj156/picture/raw/master/image/thread/image-20210226101646408.png" alt="image-20210226101646408" style="zoom:50%;" />

> 服务器突然出现大量`报错`，如mybatis报错，sql检查没问题。

观察同一时间的请求日志，发现多个如下请求：

<img src="https://gitee.com/lwj156/picture/raw/master/image/thread/image-20210226101510073.png" alt="image-20210226101510073" style="zoom:50%;" />

<img src="https://gitee.com/lwj156/picture/raw/master/image/thread/image-20210226101522212.png" alt="image-20210226101522212" style="zoom:50%;" />

- `/actuator/env`请求可以修改环境变量参数，包括linux操作系统命令

### 存在问题

![image-20210226105011740](https://gitee.com/lwj156/picture/raw/master/image/thread/image-20210226105011740.png)

1. springboot actuator提供了很多`暴露`接口用于开发人员获取对应的监控信息，如info、mappings等，当然也有一些接口可能导致环境变量被修改

2. 如果集成了`HikariCP`作为数据库连接池：该连接池有个提供连接前执行sql的配置`spring.datasource.hikari.connection-test-query`，这就很容易导致一些sql侵入命令的执行

### 解决方式

配置参数`management.endpoints.web.exposure.include`管理好需要暴露的接口，尽量不要使用*。

### 参考文档

[actuator参数官方文档](https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready-endpoints)

